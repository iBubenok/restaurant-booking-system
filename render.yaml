services:
  # API Service
  - type: web
    name: booking-api
    runtime: python
    region: frankfurt
    plan: free
    branch: main
    buildCommand: "cd api-service && pip install -r requirements.txt"
    startCommand: "cd api-service && alembic upgrade head && python seed_data.py && uvicorn app.main:app --host 0.0.0.0 --port $PORT"
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: booking-db
          property: connectionString
      - key: KAFKA_BOOTSTRAP_SERVERS
        value: "your-kafka-host:9092"
      - key: KAFKA_TOPIC
        value: "booking_events"
      - key: PYTHON_VERSION
        value: "3.11.0"
    healthCheckPath: /health

  # Booking Service (Background Worker)
  - type: worker
    name: booking-worker
    runtime: python
    region: frankfurt
    plan: free
    branch: main
    buildCommand: "cd booking-service && pip install -r requirements.txt"
    startCommand: "cd booking-service && python -m app.consumer"
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: booking-db
          property: connectionString
      - key: KAFKA_BOOTSTRAP_SERVERS
        value: "your-kafka-host:9092"
      - key: KAFKA_TOPIC
        value: "booking_events"
      - key: KAFKA_GROUP_ID
        value: "booking_service_group"
      - key: PYTHON_VERSION
        value: "3.11.0"

databases:
  - name: booking-db
    databaseName: booking_db
    user: booking_user
    region: frankfurt
    plan: free

# Примечания:
# 1. Для Kafka нужно настроить отдельно (например, через Upstash Kafka)
# 2. После создания Kafka добавьте KAFKA_BOOTSTRAP_SERVERS в Environment Variables
# 3. Database credentials будут автоматически подставлены через fromDatabase
